# Hathor Transaction

## Overview

The hathor transaction serialized

## Structure

### Transaction

| Field | Size (bytes) | Description |
| --- | :---: | --- |
| `change info` | var | Bytes representing the existence of a change output and the bip32 path of the change address |
| `tx_version` | 2 | TX Version, indicates this is a transaction, block, etc. |
| `num_tokens` | 1 | Number of token UIDs present on the data below |
| `num_inputs` | 1 | Number of inputs present on the data below |
| `num_outputs` | 1 | Number of outputs present on the data below |
| `tokens` | 32\*`num_tokens` | list of Token UIDs |
| `inputs` | 35\*`num_inputs` | list of Inputs |
| `outputs` | var | List of Outputs |

#### Change info

| Field | Size | Description |
| --- | --- | --- |
| `has_change_output` | 1bit | Indicates existence of a change output.<br>(mask `0x80`)<br>If false, the whole first byte is 0. |
| `change bip32 path length` | 4bits | if `has_change_output=true` this will be the last 4 bits of the first byte<br>(mask `0x0F`) |
| `change output index` | 1 byte | the index of the change output |
| `change bip32 path` | var (`4*bip32_path_length`) | an array of 32bit unsigned integers of the path indexes |

Obs: bip32 paths have a hard depth limitation of 5, so the max value of the change info is 22 bytes


#### TX Output

| Field | Size (bytes) | Description |
| --- | --- | --- |
| `value` | 4 or 8 | value of the output, first bit indicates if it's 4 or 8 bytes.<br>If 0: unsigned 32bit integer<br>If 1: value is the negative of the signed 64 bit integer |
| `token_data` | 1 | token data |
| `script length` | 2 | length of the script |
| `script` | var (`script_length`) | script of the output |

Obs: currently only P2PKH is supported for the script and only HTR tokens

#### TX Input

| Field | Size (bytes) | Description |
| --- | --- | --- |
| `TX id` | 32 | id of the TX the input belongs to |
| `input index` | 1 | output index of the input on the TX being spent |
| `data length` | 2 | length of the data that should follow, but since we are using these bytes as sighash_all, we do not send this data, and this MUST be 0. |

### Signature

Deterministic ECDSA ([RFC 6979](https://tools.ietf.org/html/rfc6979)) is used to sign transaction on the [SECP-256k1](https://www.secg.org/sec2-v2.pdf#subsubsection.2.4.1) curve.
The SDK call used should be `cx_ecdsa_sign` of the message.
The message is everything after the `change_info` (the `sighash_all`).

## Address format

Hathor addresses are generated by b58 encodeding the hash160 of the compressed pubkey.
For validation, verifying the pubkey hash is enough, but for user confirmation the address must be b58 encoded.
